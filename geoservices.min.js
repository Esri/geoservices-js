!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Geoservices=e()}}(function(){return function e(t,r,n){function o(s,u){if(!r[s]){if(!t[s]){var a="function"==typeof require&&require;if(!u&&a)return a(s,!0);if(i)return i(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var f=r[s]={exports:{}};t[s][0].call(f.exports,function(e){var r=t[s][1][e];return o(r||e)},f,f.exports,e,t,r,n)}return r[s].exports}for(var i="function"==typeof require&&require,s=0;s<n.length;s++)o(n[s]);return o}({1:[function(e,t,r){var n=e("./lib/geocode"),o=e("./lib/featureservice"),i=e("./lib/authentication");t.exports=function(e){this.options=e,this.geocode=n.geocode,this.featureservice=o.FeatureService,this.authenticate=i.authenticate;var t=this;this.geocode.Batch=function(e){return e=e||t.token,new n.Batch(e)}}},{"./lib/authentication":2,"./lib/featureservice":3,"./lib/geocode":4}],2:[function(e,t,r){function n(e,t,r,n){function i(e,t,r){var o;if(r)try{o=JSON.parse(r),a.token=o}catch(e){return void n("Error parsing JSON in authentication response: "+e,o)}n(e,o)}var s="https://www.arcgis.com/sharing/generateToken";this.options&&this.options.authenticationUrl&&(s=this.options.authenticationUrl);var u={username:e,password:t,f:"json",referer:"geoservices-js"};r&&(r.expiration&&(u.expiration=r.expiration),r.referer&&(u.referer=r.referer));var a=this;r.requestHandler?r.requestHandler.post(s,u,i):o.post({url:s,form:u},i)}var o=e("request");n.request=o,r.authenticate=n},{request:13}],3:[function(e,t,r){function n(e,t){if(!(this instanceof n))return new n(e,t);this.lastQuery=null,this.url=null,this.options=e,this.callback=t,this.get()}function o(e,t,r){try{t=JSON.parse(t)}catch(e){return void(r&&r("Error parsing JSON in Feature Service response: "+e,t))}r&&(t&&t.error?r(t.error,null):r(e,t))}function i(e,t){"[object Array]"!==Object.prototype.toString.call(t)&&(t=[t]);for(var r=0;r<t.length;r++){var n=t[r];if(e&&e.hasOwnProperty(n)){var o=e[n];"string"!=typeof o&&"[object String]"!=Object.prototype.toString.call(o)&&(e[n]=JSON.stringify(o))}}}var s=e("querystring"),u=e("request");n.prototype.buildUrl=function(){this.options;return this.options.url?this.options.url:[this.options.catalog,this.options.service,this.options.type].join("/")+(this.options.layer?"/"+this.options.layer:"")},n.prototype.get=function(){var e=this.options,t=this.callback;!e||e.catalog||e.service||e.type||e.url?(this.url=this.buildUrl(),this.token=e.token,this.issueRequest(null,{f:e.format||"json"},t)):this.callback&&t('Must provide at least a feature service "catalog", "service" and "type", or a "url" to a feature service or feature layer')},n.prototype.issueRequest=function(e,t,r,n){t.f=t.f||"json",t.outFields=t.outFields||"*",(t.token||this.token)&&(t.token=t.token||this.token);var i="";e&&(i="/"+e);var a=this.url+i;n&&"get"!==n.toLowerCase()?u.post(a,function(e,t,n){o(e,n,r)}).form(t):(a=a+"?"+s.stringify(t),u.get(a,function(e,t,n){o(e,n,r)}))},n.prototype.query=function(e,t){this.lastQuery=e;var r=e.method||"get";delete e.method,this.issueRequest("query",e,t,r)},n.prototype.count=function(e,t){e.returnCountOnly=!0,e.returnIdsOnly=!1,this.query(e,t)},n.prototype.ids=function(e,t){e.returnIdsOnly=!0,e.returnCountOnly=!1,this.query(e,t)},n.prototype.update=function(e,t){i(e,"features"),this.issueRequest("updateFeatures",e,t,"post")},n.prototype.add=function(e,t){i(e,"features"),this.issueRequest("addFeatures",e,t,"post")},n.prototype.remove=function(e,t){this.issueRequest("deleteFeatures",e,t,"post")},n.prototype.edit=function(e,t){i(e,["adds","updates"]),this.issueRequest("applyEdits",e,t,"post")},n.prototype.queryRelatedRecords=function(e,t){this.lastQuery=e;var r=e.method||"get";delete e.method,this.issueRequest("queryRelatedRecords",e,t,r)},r.FeatureService=n},{querystring:11,request:13}],4:[function(e,t,r){function n(e){var t="https://geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer";return e&&e.geocoderUrl&&(t=e.geocoderUrl),t}function o(e,t,r,n){if(e)n(e);else if(200==t.statusCode){var o;try{o=JSON.parse(r)}catch(e){n(e)}o.error?n(o.error):n(null,o)}else n("Unknown Error: HTTP status "+t.statusCode)}function i(e,t){e.f||(e.f="json"),e.text&&(e.singleLine=e.text,delete e.text);var r=n(this.options);r+="/findAddressCandidates?",e.outFields||(e.outFields="Addr_type"),"*"!==e.outFields&&e.outFields.indexOf("Addr_type")<0&&(e.outFields+=",Addr_type"),r+=c(e),a.get(r,function(e,r,n){return o(e,r,n,t)})}function s(e){this.records=[],this.token=e}var u=e("querystring"),a=e("request"),c=u.stringify;s.prototype.geocode=function(e,t){t||(t=this.records.length+1),"object"==typeof e?e.hasOwnProperty("OBJECTID")||(e.OBJECTID=t):"string"==typeof e&&(e={SingleLine:e,OBJECTID:t}),this.records.push({attributes:e})},s.prototype.setToken=function(e){this.token=e},s.prototype.run=function(e){var t=new Date;if(!this.token||!this.token.token||this.token.expires<t)e("Valid authentication token is required");else{var r=JSON.stringify({records:this.records}),i={token:this.token.token,addresses:r,f:"json",referer:"geoservices-js"},s=n(this.options);s+="/geocodeAddresses",a.post(s,function(t,r,n){return o(t,r,n,e)}).form(i)}},i.simple=i,i.reverse=function(e,t){e.f=e.f||"json";var r=n(this.options);r+="/reverseGeocode?",r+=c(e),a.get(r,function(e,r,n){return o(e,r,n,t)})},r.Batch=s,r.geocode=i},{querystring:11,request:13}],5:[function(e,t,r){function n(e,t,r){for(var n=0,o=e.length;n<o;n++)a.call(e,n)&&t.call(r,e[n],n,e)}function o(e,t,r){for(var n=0,o=e.length;n<o;n++)t.call(r,e.charAt(n),n,e)}function i(e,t,r){for(var n in e)a.call(e,n)&&t.call(r,e[n],n,e)}var s=e("is-function");t.exports=function(e,t,r){if(!s(t))throw new TypeError("iterator must be a function");arguments.length<3&&(r=this),"[object Array]"===u.call(e)?n(e,t,r):"string"==typeof e?o(e,t,r):i(e,t,r)};var u=Object.prototype.toString,a=Object.prototype.hasOwnProperty},{"is-function":7}],6:[function(e,t,r){(function(e){var r;r="undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:{},t.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],7:[function(e,t,r){t.exports=function(e){var t=n.call(e);return"[object Function]"===t||"function"==typeof e&&"[object RegExp]"!==t||"undefined"!=typeof window&&(e===window.setTimeout||e===window.alert||e===window.confirm||e===window.prompt)};var n=Object.prototype.toString},{}],8:[function(e,t,r){var n=e("trim"),o=e("for-each"),i=function(e){return"[object Array]"===Object.prototype.toString.call(e)};t.exports=function(e){if(!e)return{};var t={};return o(n(e).split("\n"),function(e){var r=e.indexOf(":"),o=n(e.slice(0,r)).toLowerCase(),s=n(e.slice(r+1));void 0===t[o]?t[o]=s:i(t[o])?t[o].push(s):t[o]=[t[o],s]}),t}},{"for-each":5,trim:12}],9:[function(e,t,r){"use strict";function n(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.exports=function(e,t,r,i){t=t||"&",r=r||"=";var s={};if("string"!=typeof e||0===e.length)return s;var u=/\+/g;e=e.split(t);var a=1e3;i&&"number"==typeof i.maxKeys&&(a=i.maxKeys);var c=e.length;a>0&&c>a&&(c=a);for(var f=0;f<c;++f){var p,d,l,h,y=e[f].replace(u,"%20"),v=y.indexOf(r);v>=0?(p=y.substr(0,v),d=y.substr(v+1)):(p=y,d=""),l=decodeURIComponent(p),h=decodeURIComponent(d),n(s,l)?o(s[l])?s[l].push(h):s[l]=[s[l],h]:s[l]=h}return s};var o=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},{}],10:[function(e,t,r){"use strict";function n(e,t){if(e.map)return e.map(t);for(var r=[],n=0;n<e.length;n++)r.push(t(e[n],n));return r}var o=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};t.exports=function(e,t,r,u){return t=t||"&",r=r||"=",null===e&&(e=void 0),"object"==typeof e?n(s(e),function(s){var u=encodeURIComponent(o(s))+r;return i(e[s])?n(e[s],function(e){return u+encodeURIComponent(o(e))}).join(t):u+encodeURIComponent(o(e[s]))}).join(t):u?encodeURIComponent(o(u))+r+encodeURIComponent(o(e)):""};var i=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},s=Object.keys||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return t}},{}],11:[function(e,t,r){"use strict";r.decode=r.parse=e("./decode"),r.encode=r.stringify=e("./encode")},{"./decode":9,"./encode":10}],12:[function(e,t,r){(r=t.exports=function(e){return e.replace(/^\s*|\s*$/g,"")}).left=function(e){return e.replace(/^\s*/,"")},r.right=function(e){return e.replace(/\s*$/,"")}},{}],13:[function(e,t,r){"use strict";function n(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}function o(e,t,r){var n=e;return c(t)?(r=t,"string"==typeof e&&(n={uri:e})):n=p(t,{uri:e}),n.callback=r,n}function i(e,t,r){return t=o(e,t,r),s(t)}function s(e){function t(){var e=void 0;if(e=c.response?c.response:c.responseText||u(c),b)try{e=JSON.parse(e)}catch(e){}return e}function r(e){return clearTimeout(l),e instanceof Error||(e=new Error(""+(e||"Unknown XMLHttpRequest Error"))),e.statusCode=0,a(e,m)}function o(){if(!d){var r;clearTimeout(l),r=e.useXDR&&void 0===c.status?200:1223===c.status?204:c.status;var n=m,o=null;return 0!==r?(n={body:t(),statusCode:r,method:y,headers:{},url:h,rawRequest:c},c.getAllResponseHeaders&&(n.headers=f(c.getAllResponseHeaders()))):o=new Error("Internal XMLHttpRequest Error"),a(o,n,n.body)}}if(void 0===e.callback)throw new Error("callback argument missing");var s=!1,a=function(t,r,n){s||(s=!0,e.callback(t,r,n))},c=e.xhr||null;c||(c=e.cors||e.useXDR?new i.XDomainRequest:new i.XMLHttpRequest);var p,d,l,h=c.url=e.uri||e.url,y=c.method=e.method||"GET",v=e.body||e.data,g=c.headers=e.headers||{},w=!!e.sync,b=!1,m={body:void 0,headers:{},statusCode:0,method:y,url:h,rawRequest:c};if("json"in e&&!1!==e.json&&(b=!0,g.accept||g.Accept||(g.Accept="application/json"),"GET"!==y&&"HEAD"!==y&&(g["content-type"]||g["Content-Type"]||(g["Content-Type"]="application/json"),v=JSON.stringify(!0===e.json?v:e.json))),c.onreadystatechange=function(){4===c.readyState&&setTimeout(o,0)},c.onload=o,c.onerror=r,c.onprogress=function(){},c.onabort=function(){d=!0},c.ontimeout=r,c.open(y,h,!w,e.username,e.password),w||(c.withCredentials=!!e.withCredentials),!w&&e.timeout>0&&(l=setTimeout(function(){if(!d){d=!0,c.abort("timeout");var e=new Error("XMLHttpRequest timeout");e.code="ETIMEDOUT",r(e)}},e.timeout)),c.setRequestHeader)for(p in g)g.hasOwnProperty(p)&&c.setRequestHeader(p,g[p]);else if(e.headers&&!n(e.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in e&&(c.responseType=e.responseType),"beforeSend"in e&&"function"==typeof e.beforeSend&&e.beforeSend(c),c.send(v||null),c}function u(e){if("document"===e.responseType)return e.responseXML;var t=e.responseXML&&"parsererror"===e.responseXML.documentElement.nodeName;return""!==e.responseType||t?null:e.responseXML}var a=e("global/window"),c=e("is-function"),f=e("parse-headers"),p=e("xtend");t.exports=i,i.XMLHttpRequest=a.XMLHttpRequest||function(){},i.XDomainRequest="withCredentials"in new i.XMLHttpRequest?i.XMLHttpRequest:a.XDomainRequest,function(e,t){for(var r=0;r<e.length;r++)t(e[r])}(["get","put","post","patch","head","delete"],function(e){i["delete"===e?"del":e]=function(t,r,n){return r=o(t,r,n),r.method=e.toUpperCase(),s(r)}})},{"global/window":6,"is-function":7,"parse-headers":8,xtend:14}],14:[function(e,t,r){t.exports=function(){for(var e={},t=0;t<arguments.length;t++){var r=arguments[t];for(var o in r)n.call(r,o)&&(e[o]=r[o])}return e};var n=Object.prototype.hasOwnProperty},{}]},{},[1])(1)});
